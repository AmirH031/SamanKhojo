import{c as O,e as E,v as z,Q as A,R as D,V as b,W as $,Y as w,j as e,a as S,k,Z as C,_ as B,M as H,$ as Q}from"./index-CoRpFcO_.js";import{r as u}from"./vendor-ByojS96y.js";import{u as V,A as W,m as F}from"./ui-JBksMQam.js";import"./utils-dW3-0Dkj.js";import"./firebase-CHM_3GU8.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=O("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),K=async(s,t={},i=50)=>{try{const n=[],d=s.toLowerCase().trim();if(!d)return n;let p=(await E()).filter(c=>!(t.shopType&&c.type!==t.shopType||t.location&&v(t.location.lat,t.location.lng,c.location.lat,c.location.lng)>t.location.radius));for(const c of p)try{const o=await z(c.id,void 0,!0);for(const r of o){const l=Y(r,d);if(l.score>0){if(t.category&&r.category!==t.category||t.availability!==void 0&&r.availability!==t.availability||t.priceRange&&r.price&&(r.price<t.priceRange.min||r.price>t.priceRange.max))continue;const y={item:r,shop:c,matchScore:l.score,matchType:l.type,priceInfo:Z(r),attractiveFeatures:G(r,c)};n.push(y)}}}catch(o){console.error(`Error searching items in shop ${c.id}:`,o)}return n.sort((c,o)=>{switch(t.sortBy){case"price_low":return(c.item.price||0)-(o.item.price||0);case"price_high":return(o.item.price||0)-(c.item.price||0);case"rating":return(o.item.rating||0)-(c.item.rating||0);case"popularity":return(o.item.reviewCount||0)-(c.item.reviewCount||0);case"distance":if(t.location){const r=v(t.location.lat,t.location.lng,c.shop.location.lat,c.shop.location.lng),l=v(t.location.lat,t.location.lng,o.shop.location.lat,o.shop.location.lng);return r-l}return o.matchScore-c.matchScore;default:return o.matchScore-c.matchScore}}),n.slice(0,i)}catch(n){return console.error("Error in enhanced search:",n),[]}},Y=(s,t)=>{let i=0,n="name";if(s.name){if(s.name.toLowerCase()===t)return{score:100,type:"name"};s.name.toLowerCase().startsWith(t)?(i=90,n="name"):s.name.toLowerCase().includes(t)&&(i=80,n="name")}return i===0&&(s.hindi_name&&s.hindi_name.toLowerCase().includes(t)?(i=75,n="name"):s.highlights&&s.highlights.some(d=>d.toLowerCase().includes(t))?(i=70,n="description"):s.brand_name&&s.brand_name.toLowerCase().includes(t)?(i=65,n="brand"):s.category&&s.category.toLowerCase().includes(t)?(i=60,n="category"):s.tags&&s.tags.some(d=>d.toLowerCase().includes(t))?(i=50,n="tags"):s.description&&s.description.toLowerCase().includes(t)?(i=40,n="description"):s.variety&&s.variety.toLowerCase().includes(t)&&(i=35,n="description")),s.isPopular&&(i+=10),s.isFeatured&&(i+=15),s.rating&&s.rating>=4&&(i+=5),{score:i,type:n}},Z=s=>{if(!s.price)return;const t=s.price,i=s.originalPrice||s.price,n=s.discount||0,d=n>0&&i>t;return{current:t,original:d?i:void 0,discount:d?n:void 0,hasDiscount:d}},G=(s,t)=>{const i=[];return s.discount&&s.discount>0&&i.push(`${s.discount}% OFF`),s.price&&s.price<50&&i.push("Budget Friendly"),s.rating&&s.rating>=4.5&&i.push("⭐ Highly Rated"),s.isPopular&&i.push("🔥 Popular Choice"),s.isFeatured&&i.push("✨ Featured"),s.type==="product"&&s.inStock&&s.inStock>10&&i.push("✅ In Stock"),s.deliveryTime&&i.push(`🚚 ${s.deliveryTime}`),t.isVerified&&i.push("🛡️ Verified Shop"),t.isFeatured&&i.push("⭐ Premium Store"),t.averageRating&&t.averageRating>=4&&i.push(`${t.averageRating}⭐ Shop`),s.type==="menu"&&i.push("🍽️ Fresh Made"),s.type==="service"&&i.push("🔧 Service Available"),i.slice(0,3)},v=(s,t,i,n)=>{const x=(i-s)*Math.PI/180,p=(n-t)*Math.PI/180,c=Math.sin(x/2)*Math.sin(x/2)+Math.cos(s*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},J=async s=>{const t=Date.now(),{query:i,type:n="all",location:d,limit:x=50}=s;try{const p=await A(i,d);if(p&&p.length>0){const c=[],o=[];return p.forEach(r=>{if(r.type==="item"||r.type==="menu"){const l={item:{id:r.id,shopId:r.shopId,type:r.type==="menu"?"menu":"product",name:r.name,description:r.description,price:r.price,availability:!0},shop:{id:r.shopId,shopName:r.shopName,address:r.shopAddress,distance:r.distance},matchScore:r.matchScore||0,matchType:"name",attractiveFeatures:[]};c.push(l)}else if(r.type==="shop"){const l={id:r.id,shopName:r.name,address:r.shopAddress,distance:r.distance};o.push(l)}}),{items:n==="shops"?[]:c.slice(0,x),shops:n==="items"?[]:o.slice(0,x),totalResults:c.length+o.length,searchTime:Date.now()-t}}}catch(p){console.warn("Backend search failed, using fallback:",p)}return X(s,t)},X=async(s,t)=>{const{query:i,type:n="all",filters:d={},location:x,limit:p=50}=s,c=[];n==="all"||n==="items"?c.push(K(i,d,p).catch(()=>[])):c.push(Promise.resolve([])),n==="all"||n==="shops"?x?c.push(D({location:{latitude:x.lat,longitude:x.lng},search:i,sortBy:"distance"}).catch(()=>b(i).catch(()=>[]))):c.push(b(i).catch(()=>[])):c.push(Promise.resolve([]));const[o,r]=await Promise.all(c);return{items:o||[],shops:r||[],totalResults:((o==null?void 0:o.length)||0)+((r==null?void 0:r.length)||0),searchTime:Date.now()-t}},ie=()=>{const[s,t]=u.useState(""),[i,n]=u.useState([]),[d,x]=u.useState([]),[p,c]=u.useState(!1),[o,r]=u.useState(!1),[l,y]=u.useState({type:[],rating:0,distance:50,isOpen:!1}),{t:m,i18n:N}=$(),R=V(),T=[{key:"restaurant",label:m("search.restaurant"),icon:"🍽️"},{key:"cafe",label:m("search.cafe"),icon:"☕"},{key:"hotel",label:m("search.hotel"),icon:"🏨"}];u.useEffect(()=>{s.trim()?M():(n([]),x([]))},[s]),u.useEffect(()=>{I()},[i,l]);const M=async()=>{if(s.trim()){c(!0);try{const a=await J({query:s,type:"shops",limit:50});n(a.shops)}catch(a){console.error("Search error:",a),n([])}finally{c(!1)}}},I=()=>{let a=[...i];l.type.length>0&&(a=a.filter(h=>l.type.includes(h.type))),l.rating>0&&(a=a.filter(h=>!h.ratings||h.ratings.length===0?!1:h.ratings.reduce((f,j)=>f+j,0)/h.ratings.length>=l.rating)),l.isOpen&&(a=a.filter(h=>w(h.openingTime||"",h.closingTime||"").isOpen)),x(a)},L=(a,h)=>{y(g=>({...g,[a]:g[a].includes(h)?g[a].filter(f=>f!==h):[...g[a],h]}))},P=()=>{y({type:[],rating:0,distance:50,isOpen:!1})},_=a=>{switch(a){case"restaurant":return"🍽️";case"cafe":return"☕";case"hotel":return"🏨";default:return"🏪"}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:m("search.title")}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(S,{className:"absolute left-4 top-4 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:m("search.placeholder"),value:s,onChange:a=>t(a.target.value),className:"w-full pl-12 pr-4 py-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-orange-500 text-lg"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>r(!o),className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors",children:[e.jsx(U,{size:18}),e.jsx("span",{children:m("search.filters")})]}),(l.type.length>0||l.rating>0||l.isOpen)&&e.jsx("button",{onClick:P,className:"text-orange-600 hover:text-orange-700 text-sm font-medium",children:m("search.clearFilters")})]})]})}),e.jsx(W,{children:o&&e.jsx(F.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:m("search.shopType")}),e.jsx("div",{className:"space-y-2",children:T.map(a=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.type.includes(a.key),onChange:()=>L("type",a.key),className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("span",{className:"text-gray-700",children:a.label})]},a.key))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:m("search.minimumRating")}),e.jsx("div",{className:"space-y-2",children:[4,3,2,1].map(a=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"rating",checked:l.rating===a,onChange:()=>y(h=>({...h,rating:a})),className:"border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[[...Array(a)].map((h,g)=>e.jsx(k,{size:16,className:"fill-current text-yellow-400"},g)),e.jsx("span",{className:"text-gray-700",children:"& up"})]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:m("search.availability")}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.isOpen,onChange:a=>y(h=>({...h,isOpen:a.target.checked})),className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsx("span",{className:"text-gray-700",children:m("search.openNow")})]})]})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[p&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}),!p&&s&&d.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:m("search.noResults")}),e.jsx("p",{className:"text-gray-600",children:m("search.tryDifferentKeywords")})]}),!p&&d.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[d.length," ",m("search.resultsFound")]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map((a,h)=>{const g=w(a.openingTime||"",a.closingTime||"");return e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.1},onClick:()=>R(`/shop/${a.id}`),className:"bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-all cursor-pointer",children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx("img",{src:a.imageUrl||"https://images.pexels.com/photos/262978/pexels-photo-262978.jpeg?auto=compress&cs=tinysrgb&w=400",alt:a.shopName,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"text-2xl",children:_(a.type)})}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g.isOpen?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:B(a.shopName,a.hindi_name,N.language)}),C(a.hindi_name)&&N.language!=="hi"&&e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:a.hindi_name}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 text-sm mb-2",children:[e.jsx(H,{size:14}),e.jsx("span",{className:"truncate",children:a.address})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 text-sm mb-3",children:[e.jsx(Q,{size:14}),e.jsx("span",{children:g.formattedHours})]}),C(a.ratings)&&a.ratings.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(k,{size:16,className:"fill-current text-yellow-400"}),e.jsx("span",{className:"font-medium",children:(a.ratings.reduce((f,j)=>f+j,0)/a.ratings.length).toFixed(1)})]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",a.ratings.length," ",m("search.reviews"),")"]})]})]})]},a.id)})})]})]})]})};export{ie as default};
