import{c as L,u as Y,j as e,af as A,a5 as B,x as J,q as E,w as U,a1 as I,C as D,ab as V,ag as _}from"./index-CoRpFcO_.js";import{r as o}from"./vendor-ByojS96y.js";import{toast as n}from"./utils-dW3-0Dkj.js";import{u as G,m as i,A as H}from"./ui-JBksMQam.js";import{P as K}from"./plus-BcViIRHA.js";import{T as Q}from"./trash-2-_XehuA33.js";import"./firebase-CHM_3GU8.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=L("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),ne=()=>{const[p,x]=o.useState([]),[y,h]=o.useState([]),[T,f]=o.useState(!0),[j,N]=o.useState(!1),[q,w]=o.useState(!1),[M,F]=o.useState([]),[v,d]=o.useState(!1),[$,g]=o.useState(!1),u=G(),{user:a,profile:m,needsProfileSetup:O}=Y();o.useEffect(()=>{a?k():f(!1)},[a]);const k=async()=>{if(a)try{const s=await fetch(`/api/bag/${a.uid}`,{headers:{Authorization:`Bearer ${await a.getIdToken()}`}});if(!s.ok)throw new Error("Failed to fetch bag items");const t=await s.json();x(t.bag.items||[]),h(t.bag.shopGroups||[])}catch(s){console.error("Error fetching bag items:",s),n.error("Failed to load bag items")}finally{f(!1)}},S=async(s,t)=>{if(t<=0){C(s);return}try{if(!(await fetch(`/api/bag/item/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await a.getIdToken()}`},body:JSON.stringify({quantity:t})})).ok)throw new Error("Failed to update quantity");x(r=>r.map(c=>c.itemId===s?{...c,quantity:t}:c)),h(r=>r.map(c=>({...c,items:c.items.map(b=>b.itemId===s?{...b,quantity:t}:b)})))}catch(l){console.error("Error updating quantity:",l),n.error("Failed to update quantity")}},C=async s=>{try{if(!(await fetch(`/api/bag/item/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${await a.getIdToken()}`}})).ok)throw new Error("Failed to remove item");x(l=>l.filter(r=>r.itemId!==s)),h(l=>l.map(r=>({...r,items:r.items.filter(c=>c.itemId!==s)})).filter(r=>r.items.length>0)),n.success("Item removed from bag")}catch(t){console.error("Error removing item:",t),n.error("Failed to remove item")}},W=async()=>{if(!a){d(!0);return}if(O){g(!0);return}if(p.length===0){n.error("Your bag is empty");return}N(!0);try{const s=await fetch("/api/bag/confirm",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await a.getIdToken()}`},body:JSON.stringify({userPhone:m==null?void 0:m.phoneNumber,userName:m==null?void 0:m.name})});if(!s.ok)throw new Error("Failed to confirm booking");const t=await s.json();F(t.links),w(!0),x([]),h([]),n.success(`Booking confirmed! WhatsApp links generated for ${t.totalShops} shops.`)}catch(s){console.error("Error confirming booking:",s),n.error("Failed to confirm booking. Please try again.")}finally{N(!1)}},R=async s=>{try{const l=new URL(s.whatsappLink).searchParams.get("text")||"";await navigator.clipboard.writeText(l),n.success("Message copied to clipboard!")}catch(t){console.error("Error copying message:",t),n.error("Failed to copy message")}},z=p.reduce((s,t)=>s+t.quantity,0),P=y.length;return a?T?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:e.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Bag"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we fetch your items..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 py-8",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs(i.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("button",{onClick:()=>u(-1),className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 mb-4 transition-colors",children:[e.jsx(J,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-2",children:"Shopping Bag"}),e.jsxs("p",{className:"text-gray-600",children:[z," items from ",P," shops"]})]}),p.length===0?e.jsx(i.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:"text-center py-16",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-md rounded-3xl p-12 border border-white/20 shadow-lg",children:[e.jsx(A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Your bag is empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Start shopping to add items to your bag"}),e.jsx("button",{onClick:()=>u("/"),className:"bg-gradient-to-r from-blue-600 to-teal-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-teal-700 transition-all font-medium",children:"Start Shopping"})]})}):e.jsxs("div",{className:"space-y-6",children:[y.map(s=>e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"text-blue-600",size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.shopName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.items.length," items"]})]})]}),e.jsx("div",{className:"space-y-4",children:s.items.map(t=>e.jsxs(i.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center shadow-sm",children:e.jsx(U,{size:20,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.itemName}),t.price&&e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["₹",t.price]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>S(t.itemId,t.quantity-1),className:"w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full flex items-center justify-center transition-colors",children:e.jsx(Z,{size:14})}),e.jsx("span",{className:"w-8 text-center font-medium",children:t.quantity}),e.jsx("button",{onClick:()=>S(t.itemId,t.quantity+1),className:"w-8 h-8 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-colors",children:e.jsx(K,{size:14})}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:t.unit})]}),e.jsx("button",{onClick:()=>C(t.itemId),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Q,{size:16})})]},t.itemId))})]},s.shopId)),e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ready to Book?"}),e.jsxs("p",{className:"text-gray-600",children:[z," items from ",P," shops"]})]})}),e.jsx("button",{onClick:W,disabled:j,className:"w-full bg-gradient-to-r from-green-600 to-teal-600 text-white py-4 px-6 rounded-2xl font-semibold text-lg hover:from-green-700 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center space-x-2",children:j?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:24}),e.jsx("span",{children:"Confirm Booking"})]})}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"WhatsApp messages will be generated for each shop"})]})]})]}),e.jsx(H,{children:q&&e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(i.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"text-green-600",size:32})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-gray-600",children:"Your booking has been prepared. Click the buttons below to message each shop on WhatsApp."})]}),e.jsx("div",{className:"space-y-4",children:M.map((s,t)=>e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"text-green-600",size:18})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.shopName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.totalQuantity," items • ",s.shopPhone]})]})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("a",{href:s.whatsappLink,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center space-x-2 bg-green-600 text-white py-3 px-4 rounded-xl hover:bg-green-700 transition-colors font-medium",children:[e.jsx(I,{size:18}),e.jsx("span",{children:"Message on WhatsApp"}),e.jsx(V,{size:14})]}),e.jsx("button",{onClick:()=>R(s),className:"px-4 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors",title:"Copy message",children:e.jsx(X,{size:18})})]})]},s.shopId))}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{w(!1),u("/")},className:"bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors",children:"Continue Shopping"})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-blue-800 text-center",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Shop owners will confirm availability and pricing via WhatsApp. You can coordinate pickup details directly with them."]})})]})})}),e.jsx(B,{isOpen:v,onClose:()=>d(!1),onSuccess:()=>d(!1)}),e.jsx(_,{isOpen:$,onClose:()=>g(!1),onSuccess:()=>g(!1)})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:[e.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200",children:[e.jsx(A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please login to view your bag"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors",children:"Login"})]})}),e.jsx(B,{isOpen:v,onClose:()=>d(!1),onSuccess:()=>{d(!1),k()}})]})};export{ne as default};
